<div class="easyui-layout" data-options="fit:true">
    <!-- Begin of toolbar -->
    <div id="schedule-toolbar-2">
        <div class="wu-toolbar-button">
            <a href="#" class="easyui-linkbutton" iconCls="icon-add" onclick="openAdd()" plain="true">添加</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-edit" onclick="openEdit()" plain="true">修改</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-remove" onclick="remove()" plain="true">删除</a>
        </div>
    </div>
    <table id="schedule-datagrid-2" class="easyui-datagrid" toolbar="#schedule-toolbar-2"></table>
</div>
<!-- Begin of easyui-dialog -->
<div id="schedule-dialog-2" class="easyui-dialog" data-options="closed:true,iconCls:'icon-save'" style="width:400px; padding:10px;">
</div>
<!-- End of easyui-dialog -->
<script type="text/javascript">
    $(function(){
        /**
         * Name 载入数据
         */
        $('#schedule-datagrid-2').datagrid({
            loadFilter:pagerFilter,
            rownumbers:true,
            singleSelect:true,
            pageSize:20,
            pagination:false,
            multiSort:false,
            fitColumns:true,
            fit:true,
            height:485,
            columns:[[
                { field:'dayone',title:'星期一',width:100},
                { field:'daytwo',title:'星期二',width:100},
                { field:'daythree',title:'星期三',width:100},
                { field:'dayfour',title:'星期四',width:100},
                { field:'dayfive',title:'星期五',width:100},
                { field:'daysix',title:'星期六',width:100},
                { field:'dayseven',title:'星期日',width:100}
            ]],
            onClickCell:function(rowIndex, field, value){
           	  alert(rowIndex +','+field+','+value);
            }
        });
        //初始加载，表格宽度自适应
        fitCoulms();
        //浏览器窗口大小变化后，表格宽度自适应
        $(window).resize(function(){
            fitCoulms();
        });
    });

    //表格宽度自适应，这里的#dg是datagrid表格生成的div标签
    function fitCoulms(){
        $('#schedule-datagrid-2').datagrid({
            fitColumns:true
        });
    }

	/**
	* Name 添加记录
	*/
	function add(){
		//console.log($("#table-iframe").contents().find("#table-grade-choose").find("option:selected").val());
		var _my = $("#table-iframe").contents();
		var banjiid = _my.find("#table-grade-choose").find("option:selected").val();
		var mydata = {
			info:{schClaId:banjiid,schSemester:_my.find('#xueqi-choose').find("option:selected").val()+_my.find('#xueqi-time-choose').find("option:selected").val()},//获取一个系统参数
			details:[]
		}
		for(var c = 1 ; c <= 7 ; c++){
			for(var j = 1 ; j <= 10 ; j++){
				var tempObj = {dTime:''+c,dCurrId:'',dInId:''};
				var tempTime = '';
				if(c == 1){ tempObj.dTime = '星期一'; tempTime = '#mon'; }
				if(c == 2){ tempObj.dTime = '星期二'; tempTime = '#tus'; }
				if(c == 3){ tempObj.dTime = '星期三'; tempTime = '#wes'; }
				if(c == 4){ tempObj.dTime = '星期四'; tempTime = '#thr'; }
				if(c == 5){ tempObj.dTime = '星期五'; tempTime = '#fri'; }
				if(c == 6){ tempObj.dTime = '星期六'; tempTime = '#sta'; }
				if(c == 7){ tempObj.dTime = '星期日'; tempTime = '#sun'; }
				if(_my.find(tempTime+j+' .item').length > 0){
					tempObj.dCurrId = _my.find(tempTime+j+' .item').attr('id');
				}else{
					tempObj.dCurrId = '0';
				}
				if(j == 1){ tempObj.dInId = '14e0416870a54ae3899ae233e12851c9'; }
				if(j == 2){ tempObj.dInId = 'd6bcc62d8b3149f48fe34e69ca4da744'; }
				if(j == 3){ tempObj.dInId = '5256b73edcd54dc3b1dd0d7e37fe4007'; }
				if(j == 4){ tempObj.dInId = '26f6fd041a2d4bd381ffa0cac19588a5'; }
				if(j == 5){ tempObj.dInId = 'bbfabc2079cb4fc8b1954d625f824303'; }
				if(j == 6){ tempObj.dInId = '2a3819a0521341b3abd7bbf4d9ceb661'; }
				if(j == 7){ tempObj.dInId = 'f1e6e38a90e04457aa6ee8f73f276b03'; }
				if(j == 8){ tempObj.dInId = '2127065e05ad4b7da9b63f56681965b9'; }
				if(j == 9){ tempObj.dInId = '89b1dc829d6b49b1beb3549e10446207'; }
				if(j == 10){ tempObj.dInId = 'bc8f6b86daef40219b87290359704899'; }
				mydata.details.push(tempObj);
			}
		}
		//console.log(mydata);
		$.ajax({
            type:"post",
            async:false,
            url:"./schedule/save.action",
            dataType:"json",
            data:{
            	tableConds:JSON.stringify(mydata)
            },
            success:function(data){
                console.log(data);
                if(data.status == 'success'){
                	getData();
                }else{
                    //没有数据或服务器错误
                }
            }
        });
	}
	
	/**
	* Name 修改记录
	*/
	function edit(){
		$('#wu-form-2').form('submit', {
			url:'',
			success:function(data){
				if(data){
					$.messager.alert('信息提示','提交成功！','info');
					$('#schedule-dialog-2').dialog('close');
				}
				else
				{
					$.messager.alert('信息提示','提交失败！','info');
				}
			}
		});
	}
	
	/**
	* Name 删除记录
	*/
	function remove(){
		$.messager.confirm('信息提示','确定要删除该记录？', function(result){
			if(result){
				var items = $('#schedule-datagrid-2').datagrid('getSelections');
				var ids = [];
				$(items).each(function(){
					ids.push(this.productid);	
				});
				//alert(ids);return;
				$.ajax({
					url:'',
					data:'',
					success:function(data){
						if(data){
							$.messager.alert('信息提示','删除成功！','info');		
						}
						else
						{
							$.messager.alert('信息提示','删除失败！','info');		
						}
					}	
				});
			}	
		});
	}
	
	/**
	* Name 打开添加窗口
	*/
	function openAdd(){
		$('#wu-form-2').form('clear');
		$('#schedule-dialog-2').dialog({
			closed: false,
			modal:true,
            title: "添加信息",
            width:1000,
            height:600,
            content:"<iframe id='table-iframe' scrolling='auto' frameborder='0' src='timetable.html' style='width:100%; height:100%; display:block;'></iframe>",
            buttons: [{
                text: '确定',
                iconCls: 'icon-ok',
                handler: add
            }, {
                text: '取消',
                iconCls: 'icon-cancel',
                handler: function () {
                    $('#schedule-dialog-2').dialog('close');                    
                }
            }]
        });
	}
	
	/**
	* Name 打开修改窗口
	*/
	function openEdit(){
		$('#wu-form-2').form('clear');
		var item = $('#schedule-datagrid-2').datagrid('getSelected');
		//alert(item.productid);return;
		$.ajax({
			url:'',
			data:'',
			success:function(data){
				if(data){
					$('#schedule-dialog-2').dialog('close');	
				}
				else{
					//绑定值
					$('#wu-form-2').form('load', data)
				}
			}	
		});
		$('#schedule-dialog-2').dialog({
			closed: false,
			modal:true,
            title: "修改信息",
            buttons: [{
                text: '确定',
                iconCls: 'icon-ok',
                handler: edit
            }, {
                text: '取消',
                iconCls: 'icon-cancel',
                handler: function () {
                    $('#schedule-dialog-2').dialog('close');                    
                }
            }]
        });
	}	
	
	/**
	* Name 分页过滤器
	*/
	function pagerFilter(data){            
		if (typeof data.length == 'number' && typeof data.splice == 'function'){// is array                
			data = {                   
				total: data.length,                   
				rows: data               
			}            
		}        
		var dg = $(this);         
		var opts = dg.datagrid('options');          
		var pager = dg.datagrid('getPager');          
		pager.pagination({                
			onSelectPage:function(pageNum, pageSize){                 
				opts.pageNumber = pageNum;                   
				opts.pageSize = pageSize;                
				pager.pagination('refresh',{pageNumber:pageNum,pageSize:pageSize});                  
				dg.datagrid('loadData',data);                
			}          
		});           
		if (!data.originalRows){               
			data.originalRows = (data.rows);       
		}         
		var start = (opts.pageNumber-1)*parseInt(opts.pageSize);          
		var end = start + parseInt(opts.pageSize);        
		data.rows = (data.originalRows.slice(start, end));         
		return data;       
	}
	//获取课表
	function getData(){
		var param = {};
		if(Util.getLocalStorage("role") == '0'){
			param['sClaId'] = JSON.parse(Util.getLocalStorage("loginUser")).sClaId.claId;
			param['schSemester'] = encodeURI(Util.getLocalStorage("term"));
		}else if(Util.getLocalStorage("role") == '1'){
            param['tId'] = JSON.parse(Util.getLocalStorage("loginUser")).tId;
			param['schSemester'] = encodeURI(Util.getLocalStorage("term"));
		}else{
			//管理员登录，界面变化
		}
		$.ajax({
    		type:"get",
    		async:false,
    		url:"./schedule/listAll.action",
    		dataType:"json",
    		data:param,
    		success:function(data){
    			console.log(data);
    			if(data.status == 'success'){
    				var info = data.info;//得到课表
   					var rows = [];
   					var trueRow = [];
   					if(data.details.length > 0){
   						rows = data.details[0];//得到课表详情
   	       				if(rows.length > 0){
   	       					for(var i = 0 ; i < 10 ; i++){//循环10行
   	       						var temp = {
   	       	       						dayone:'',
   	       	       						daytwo:'',
   	       	       						daythree:'',
   	       	       						dayfour:'',
   	       	       						dayfive:'',
   	       	       						daysix:'',
   	       	       						dayseven:'',
   	       	       					}
   	       						for(var h = 0 ; h < rows.length ; h++){
   	       							var tempItem = rows[h];
   	       							if(tempItem.dInId.inContent == (i+1+'')){
   	           							if(tempItem.dTime == '星期一'){ temp.dayone = tempItem.dCurrId.currName;}
   	           							if(tempItem.dTime == '星期二'){ temp.daytwo = tempItem.dCurrId.currName;}
   	           							if(tempItem.dTime == '星期三'){ temp.daythree = tempItem.dCurrId.currName;}
   	           							if(tempItem.dTime == '星期四'){ temp.dayfour = tempItem.dCurrId.currName;}
   	           							if(tempItem.dTime == '星期五'){ temp.dayfive = tempItem.dCurrId.currName;}
   	           							if(tempItem.dTime == '星期六'){ temp.daysix = tempItem.dCurrId.currName;}
   	           							if(tempItem.dTime == '星期日'){ temp.dayseven = tempItem.dCurrId.currName;	}
   	               					}
   	       						}
   	           					trueRow.push(temp);
   	           				}
   	           				$('#schedule-datagrid-2').datagrid('loadData', trueRow);
   	       				}
   					}
    			}else{
    				//没有数据或服务器错误
    			}
    		}
    	});
	}
	getData();
	
</script>